/*!
* chartjs-plugin-annotation v1.0.1
* https://www.chartjs.org/chartjs-plugin-annotation/index
 * (c) 2021 chartjs-plugin-annotation Contributors
 * Released under the MIT License
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("chart.js"),require("chart.js/helpers")):"function"==typeof define&&define.amd?define(["chart.js","chart.js/helpers"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["chartjs-plugin-annotation"]=t(e.Chart,e.Chart.helpers)}(this,(function(e,t){"use strict";const n=["click","dblclick"],i=["enter","leave"],o=n.concat(i);function a(e,t,n,i){if(t.listened)switch(n.type){case"mousemove":case"mouseout":!function(e,t,n){if(!t.moveListened)return;let i;"mousemove"===n.type&&(i=r(t.elements,n));const o=t.hovered;t.hovered=i,function(e,t,n,i){n&&n!==i&&s(e,t,n.options.leave||t.listeners.leave,n);i&&i!==n&&s(e,t,i.options.enter||t.listeners.enter,i)}(e,t,o,i)}(e,t,n);break;case"click":!function(e,t,n,i){const o=t.listeners,a=r(t.elements,n);if(a){const n=a.options,r=n.dblclick||o.dblclick,l=n.click||o.click;a.clickTimeout?(clearTimeout(a.clickTimeout),delete a.clickTimeout,s(e,t,r,a)):r?a.clickTimeout=setTimeout((()=>{delete a.clickTimeout,s(e,t,l,a)}),i.dblClickSpeed):s(e,t,l,a)}}(e,t,n,i)}}function s(e,n,i,o){t.callback(i,[{chart:e,element:o}])}function r(e,n){let i=Number.POSITIVE_INFINITY;return e.filter((e=>e.options.display&&e.inRange(n.x,n.y))).reduce(((e,o)=>{const a=o.getCenterPoint(),s=t.distanceBetweenPoints(n,a);return s<i?(e=[o],i=s):s===i&&e.push(o),e}),[]).sort(((e,t)=>e._index-t._index)).slice(0,1)[0]}const l=Math.PI,d=l/2;function c(e,n,i){return n="number"==typeof n?n:e.parse(n),t.isFinite(n)?e.getPixelForValue(n):i}function h(e,t,n,i,o,a){if(e.beginPath(),a){const s=Math.min(a,o/2,i/2),r=t+s,c=n+s,h=t+i-s,f=n+o-s;e.moveTo(t,c),r<h&&c<f?(e.arc(r,c,s,-l,-d),e.arc(h,c,s,-d,0),e.arc(h,f,s,0,d),e.arc(r,f,s,d,l)):r<h?(e.moveTo(r,n),e.arc(h,c,s,-d,d),e.arc(r,c,s,d,l+d)):c<f?(e.arc(r,c,s,-l,0),e.arc(r,f,s,0,l)):e.arc(r,c,s,-l,l),e.closePath(),e.moveTo(t,n)}else e.rect(t,n,i,o)}class f extends e.Element{inRange(e,t,n){const{x:i,y:o,width:a,height:s}=this.getProps(["x","y","width","height"],n);return e>=i&&e<=i+a&&t>=o&&t<=o+s}getCenterPoint(e){const{x:t,y:n,width:i,height:o}=this.getProps(["x","y","width","height"],e);return{x:t+i/2,y:n+o/2}}draw(e){const{x:t,y:n,width:i,height:o,options:a}=this;e.save(),e.lineWidth=a.borderWidth,e.strokeStyle=a.borderColor,e.fillStyle=a.backgroundColor,e.setLineDash(a.borderDash),e.lineDashOffset=a.borderDashOffset,h(e,t,n,i,o,a.cornerRadius),e.fill(),a.borderWidth&&e.stroke(),e.restore()}resolveElementProperties(e,t){const n=e.scales[t.xScaleID],i=e.scales[t.yScaleID];let o,a,{top:s,left:r,bottom:l,right:d}=e.chartArea;return n||i?(n&&(o=c(n,t.xMin,r),a=c(n,t.xMax,d),r=Math.min(o,a),d=Math.max(o,a)),i&&(o=c(i,t.yMin,l),a=c(i,t.yMax,s),s=Math.min(o,a),l=Math.max(o,a)),{x:r,y:s,x2:d,y2:l,width:d-r,height:l-s}):{options:{}}}}f.id="boxAnnotation",f.defaults={display:!0,adjustScaleRange:!0,borderDash:[],borderDashOffset:0,borderWidth:1,cornerRadius:0,xScaleID:"x",xMin:void 0,xMax:void 0,yScaleID:"y",yMin:void 0,yMax:void 0},f.defaultRoutes={borderColor:"color",backgroundColor:"color"};const u=Math.PI,x=(e,t,n)=>Math.min(n,Math.max(t,e)),y=(e,t,n)=>(n=x(n,0,1),{x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}),b=(e,t,n)=>y(t,n,Math.abs((e-t.y)/(n.y-t.y))).x,g=(e,t,n)=>y(t,n,Math.abs((e-t.x)/(n.x-t.x))).y;function p({x:e,y:t},n,{top:i,right:o,bottom:a,left:s}){return e<s&&(t=n.x<s?NaN:g(s,{x:e,y:t},n),e=s),e>o&&(t=n.x>o?NaN:g(o,{x:e,y:t},n),e=o),t<i&&(e=n.y<i?NaN:b(i,{x:e,y:t},n),t=i),t>a&&(e=n.y>a?NaN:b(a,{x:e,y:t},n),t=a),{x:e,y:t}}class m extends e.Element{intersects(e,t,n){n=n||.001;const i=this,o={x:i.x,y:i.y},a={x:i.x2,y:i.y2},s=g(e,o,a),r=b(t,o,a);return(!isFinite(s)||Math.abs(t-s)<n)&&(!isFinite(r)||Math.abs(e-r)<n)}labelIsVisible(){const e=this.options.label;return e&&e.enabled&&e.content}isOnLabel(e,t){const{labelRect:n}=this;if(!n)return!1;const{x:i,y:o}=(a={x:e,y:t},s=n,r=-n.rotation,l=Math.cos(r),d=Math.sin(r),c=s.x,h=s.y,{x:c+l*(a.x-c)-d*(a.y-h),y:h+d*(a.x-c)+l*(a.y-h)});var a,s,r,l,d,c,h;const f=n.width/2,u=n.height/2;return i>=n.x-f&&i<=n.x+f&&o>=n.y-u&&o<=n.y+u}inRange(e,t){const n=this.options.borderWidth||1;return this.intersects(e,t,n)||this.isOnLabel(e,t)}getCenterPoint(){return{x:(this.x2+this.x)/2,y:(this.y2+this.y)/2}}draw(e){const{x:t,y:n,x2:i,y2:o,options:a}=this;e.save(),e.lineWidth=a.borderWidth,e.strokeStyle=a.borderColor,e.setLineDash(a.borderDash),e.lineDashOffset=a.borderDashOffset,e.beginPath(),e.moveTo(t,n),e.lineTo(i,o),e.stroke(),e.restore()}drawLabel(e,n){this.labelIsVisible()&&(e.save(),function(e,n,i){const o=n.options.label;e.font=t.toFontString(o.font);const{width:a,height:s}=function(e,n){const i=n.content;if(i instanceof Image)return{width:M(i.width,n.width)+2*n.xPadding,height:M(i.height,n.height)+2*n.yPadding};const o=t.isArray(i)?i:[i],a=o.length;let s=0;for(let t=0;t<a;t++){const n=o[t];w.has(n)||w.set(n,e.measureText(n).width),s=Math.max(s,w.get(n))}return s+=2*n.xPadding,{width:s,height:a*n.font.size+(a+1)*n.yPadding}}(e,o),r=n.labelRect=function(e,n,i,o){const a=e.options.label,{xAdjust:s,yAdjust:r,xPadding:l,yPadding:d,position:c}=a,h={x:e.x,y:e.y},f={x:e.x2,y:e.y2},x="auto"===a.rotation?function(e){const{x:t,y:n,x2:i,y2:o}=e,a=Math.atan2(o-n,i-t);return a>u/2?a-u:a<u/-2?a+u:a}(e):t.toRadians(a.rotation),b=function(e,t,n){const i=Math.cos(n),o=Math.sin(n);return{w:Math.abs(e*i)+Math.abs(t*o),h:Math.abs(e*o)+Math.abs(t*i)}}(n,i,x),g=function(e,t,n,i){let o=.5;const a=function(e,t){const{x:n,x2:i,y:o,y2:a}=e,s=Math.min(o,a)-t.top,r=Math.min(n,i)-t.left,l=t.bottom-Math.max(o,a),d=t.right-Math.max(n,i);return{x:Math.min(r,d),y:Math.min(s,l),dx:r<d?1:-1,dy:s<l?1:-1}}(e,i),s=e.options.label;"start"===t?o=v({w:e.x2-e.x,h:e.y2-e.y},n,s,a):"end"===t&&(o=1-v({w:e.x-e.x2,h:e.y-e.y2},n,s,a));return o}(e,c,b,o),p=y(h,f,g),m={size:b.w,min:o.left,max:o.right,padding:l},M={size:b.h,min:o.top,max:o.bottom,padding:d};return{x:D(p.x,m)+s,y:D(p.y,M)+r,width:n,height:i,rotation:x}}(n,a,s,i);if(e.translate(r.x,r.y),e.rotate(r.rotation),e.fillStyle=o.backgroundColor,h(e,-a/2,-s/2,a,s,o.cornerRadius),e.fill(),e.fillStyle=o.color,t.isArray(o.content)){e.textAlign=o.textAlign;const t=function(e,t){const{textAlign:n,xPadding:i}=e;if("start"===n)return-t/2+i;if("end"===n)return+t/2-i;return 0}(o,a);let n=-s/2+o.yPadding;for(let i=0;i<o.content.length;i++)e.textBaseline="top",e.fillText(o.content[i],t,n),n+=o.font.size+o.yPadding}else if(o.content instanceof Image){const t=-a/2+o.xPadding,n=-s/2+o.yPadding;e.drawImage(o.content,t,n,a-2*o.xPadding,s-2*o.yPadding)}else e.textAlign="center",e.textBaseline="middle",e.fillText(o.content,0,0)}(e,this,n),e.restore())}resolveElementProperties(e,t){const n=e.scales[t.scaleID];let i,o,{top:a,left:s,bottom:r,right:l}=e.chartArea;if(n)i=c(n,t.value,NaN),o=c(n,t.endValue,i),n.isHorizontal()?(s=i,l=o):(a=i,r=o);else{const n=e.scales[t.xScaleID],i=e.scales[t.yScaleID];n&&(s=c(n,t.xMin,s),l=c(n,t.xMax,l)),i&&(a=c(i,t.yMin,a),r=c(i,t.yMax,r))}return function(e,t,n){const{x:i,y:o}=p(e,t,n),{x:a,y:s}=p(t,e,n);return{x:i,y:o,x2:a,y2:s,width:Math.abs(a-i),height:Math.abs(s-o)}}({x:s,y:a},{x:l,y:r},e.chartArea)}}function M(e,t){return"number"==typeof t?t:"string"==typeof t?("string"==typeof(n=t)&&n.endsWith("%")&&parseFloat(n)/100)*e:e;var n}m.id="lineAnnotation",m.defaults={display:!0,adjustScaleRange:!0,borderWidth:2,borderDash:[],borderDashOffset:0,label:{backgroundColor:"rgba(0,0,0,0.8)",drawTime:void 0,font:{family:void 0,lineHeight:void 0,size:void 0,style:"bold",weight:void 0},color:"#fff",xPadding:6,yPadding:6,rotation:0,cornerRadius:6,position:"center",xAdjust:0,yAdjust:0,textAlign:"center",enabled:!1,content:null},value:void 0,endValue:void 0,scaleID:void 0,xScaleID:"x",xMin:void 0,xMax:void 0,yScaleID:"y",yMin:void 0,yMax:void 0},m.defaultRoutes={borderColor:"color"};const w=new Map;function v(e,t,n,i){const{xPadding:o,yPadding:a}=n,s=e.w*i.dx,r=e.h*i.dy,l=s>0&&(t.w/2+o-i.x)/s,d=r>0&&(t.h/2+a-i.y)/r;return x(Math.max(l,d),0,.25)}function D(e,t){const{size:n,min:i,max:o,padding:a}=t,s=n/2;return n>o-i?(o+i)/2:(i>=e-a-s&&(e=i+a+s),o<=e+a+s&&(e=o-a-s),e)}class P extends f{inRange(e,t){return function(e,t){const{width:n,height:i}=t,o=t.getCenterPoint(!0),a=n/2,s=i/2;if(a<=0||s<=0)return!1;return Math.pow(e.x-o.x,2)/Math.pow(a,2)+Math.pow(e.y-o.y,2)/Math.pow(s,2)<=1}({x:e,y:t},this)}draw(e){const{width:t,height:n,options:i}=this,o=this.getCenterPoint();e.save(),e.beginPath(),e.lineWidth=i.borderWidth,e.strokeStyle=i.borderColor,e.fillStyle=i.backgroundColor,e.setLineDash(i.borderDash),e.lineDashOffset=i.borderDashOffset,e.ellipse(o.x,o.y,n/2,t/2,Math.PI/2,0,2*Math.PI),e.fill(),e.stroke(),e.restore()}}P.id="ellipseAnnotation",P.defaults={display:!0,adjustScaleRange:!0,borderDash:[],borderDashOffset:0,borderWidth:1,xScaleID:"x",xMin:void 0,xMax:void 0,yScaleID:"y",yMin:void 0,yMax:void 0},P.defaultRoutes={borderColor:"color",backgroundColor:"color"};class I extends e.Element{inRange(e,t){const{width:n,options:i}=this,o=this.getCenterPoint(!0),a=n/2+i.borderWidth;return!(a<=0)&&Math.pow(e-o.x,2)+Math.pow(t-o.y,2)<=Math.pow(a,2)}getCenterPoint(e){const{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}draw(e){const{x:t,y:n,width:i,options:o}=this;e.save(),e.lineWidth=o.borderWidth,e.strokeStyle=o.borderColor,e.fillStyle=o.backgroundColor,e.setLineDash(o.borderDash),e.lineDashOffset=o.borderDashOffset,e.beginPath(),e.arc(t,n,i/2,0,2*Math.PI),e.fill(),e.stroke(),e.restore()}resolveElementProperties(e,t){const{chartArea:n,scales:i}=e,o=i[t.xScaleID],a=i[t.yScaleID];let s=n.width/2,r=n.height/2;return o&&(s=c(o,t.xValue,s)),a&&(r=c(a,t.yValue,r)),{x:s,y:r,width:2*t.radius,height:2*t.radius}}}I.id="pointAnnotation",I.defaults={display:!0,adjustScaleRange:!0,borderDash:[],borderDashOffset:0,borderWidth:1,radius:10,xScaleID:"x",xValue:void 0,yScaleID:"y",yValue:void 0},I.defaultRoutes={borderColor:"color",backgroundColor:"color"};const k=new Map,S={box:f,line:m,ellipse:P,point:I};Object.keys(S).forEach((t=>{e.defaults.describe(`elements.${S[t].id}`,{_fallback:"plugins.annotation"})}));var T={id:"annotation",version:"1.0.1",afterRegister(){e.Chart.register(S)},afterUnregister(){e.Chart.unregister(S)},beforeInit(e){k.set(e,{annotations:[],elements:[],listeners:{},listened:!1,moveListened:!1})},beforeUpdate(e,n,i){const o=k.get(e).annotations=[];let a=i.annotations;t.isObject(a)?Object.keys(a).forEach((e=>{const n=a[e];t.isObject(n)&&(n.id=e,o.push(n))})):t.isArray(a)&&o.push(...a)},afterDataLimits(e,n){const i=k.get(e);!function(e,n,i){const o=function(e,n){const i=e.axis,o=e.id,a=i+"ScaleID";let s=t.valueOrDefault(e.min,Number.NEGATIVE_INFINITY),r=t.valueOrDefault(e.max,Number.POSITIVE_INFINITY);for(const t of n)if(t.scaleID===o)for(const n of["value","endValue"]){const i=t[n];if(i){const t=e.parse(i);s=Math.min(s,t),r=Math.max(r,t)}}else if(t[a]===o)for(const n of[i+"Min",i+"Max",i+"Value"]){const i=t[n];if(i){const t=e.parse(i);s=Math.min(s,t),r=Math.max(r,t)}}return{min:s,max:r}}(n,i);let a=!1;t.isFinite(o.min)&&void 0===n.options.min&&void 0===n.options.suggestedMin&&(a=n.min!==o.min,n.min=o.min);t.isFinite(o.max)&&void 0===n.options.max&&void 0===n.options.suggestedMax&&(a=n.max!==o.max,n.max=o.max);a&&"function"==typeof n.handleTickRangeOptions&&n.handleTickRangeOptions()}(0,n.scale,i.annotations.filter((e=>e.display&&e.adjustScaleRange)))},afterUpdate(t,a,s){const r=k.get(t);!function(e,t,a){const s=t.annotations||[];t.listened=!1,t.moveListened=!1,o.forEach((e=>{"function"==typeof a[e]&&(t.listened=!0,t.listeners[e]=a[e])})),i.forEach((e=>{"function"==typeof a[e]&&(t.moveListened=!0)})),t.listened&&t.moveListened||s.forEach((e=>{t.listened||n.forEach((n=>{"function"==typeof e[n]&&(t.listened=!0)})),t.moveListened||i.forEach((n=>{"function"==typeof e[n]&&(t.listened=!0,t.moveListened=!0)}))}))}(0,r,s),function(t,n,i,o){const a=function(t,n,i){if("reset"===i||"none"===i||"resize"===i)return C;return new e.Animations(t,n)}(t,i.animations,o),s=n.annotations,r=function(e,t){const n=t.length,i=e.length;if(i<n){const t=n-i;e.splice(i,0,...new Array(t))}else i>n&&e.splice(n,i-n);return e}(n.elements,s);for(let e=0;e<s.length;e++){const n=s[e];let i=r[e];const o=S[n.type]||S.line;i&&i instanceof o||(i=r[e]=new o);const l=O(n.setContext(j(t,i,n))),d=i.resolveElementProperties(t,l);d.skip=isNaN(d.x)||isNaN(d.y),d.options=l,a.update(i,d)}}(t,r,s,a.mode)},beforeDatasetsDraw(e){R(e,"beforeDatasetsDraw")},afterDatasetsDraw(e){R(e,"afterDatasetsDraw")},beforeDraw(e){R(e,"beforeDraw")},afterDraw(e){R(e,"afterDraw")},beforeEvent(e,t,n){a(e,k.get(e),t.event,n)},destroy(e){k.delete(e)},_getState:e=>k.get(e),defaults:{drawTime:"afterDatasetsDraw",dblClickSpeed:350,animations:{numbers:{properties:["x","y","x2","y2","width","height"],type:"number"}},label:{drawTime:null}},descriptors:{_indexable:!1,_scriptable:e=>!o.includes(e),annotations:{_allKeys:!1,_fallback:(e,t)=>`elements.${S[t.type||"line"].id}`}},additionalOptionScopes:[""]};const C={update:Object.assign};function O(e){const t=S[e.type]||S.line,n={};n.id=e.id,n.type=e.type,n.drawTime=e.drawTime,Object.assign(n,A(e,t.defaults),A(e,t.defaultRoutes));for(const t of o)n[t]=e[t];return n}function A(e,n){const i={};for(const o of Object.keys(n)){const a=n[o],s=e[o];i[o]=t.isObject(a)?A(s,a):s}return i}function j(e,t,n){return t.$context||(t.$context=Object.assign(Object.create(e.getContext()),{element:t,id:n.id,type:"annotation"}))}function R(e,n){const{ctx:i,chartArea:o}=e,a=k.get(e).elements.filter((e=>!e.skip&&e.options.display));t.clipArea(i,o),a.forEach((e=>{e.options.drawTime===n&&e.draw(i)})),t.unclipArea(i),a.forEach((e=>{"drawLabel"in e&&e.options.label&&(e.options.label.drawTime||e.options.drawTime)===n&&e.drawLabel(i,o)}))}return e.Chart.register(T),T}));
