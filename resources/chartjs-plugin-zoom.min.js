/*!
* chartjs-plugin-zoom v1.0.0-beta.5
* undefined
 * (c) 2016-2021 chartjs-plugin-zoom Contributors
 * Released under the MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("chart.js"),require("hammerjs"),require("chart.js/helpers")):"function"==typeof define&&define.amd?define(["chart.js","hammerjs","chart.js/helpers"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).ChartZoom=e(t.Chart,t.Hammer,t.Chart.helpers)}(this,(function(t,e,n){"use strict";function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var a=o(e);function i(t,e,n){return void 0===t||("string"==typeof t?-1!==t.indexOf(e):"function"==typeof t&&-1!==t({chart:n}).indexOf(e))}function c(t,e,o){const a=function({x:t,y:e},n){const o=n.scales,a=Object.keys(o);for(let n=0;n<a.length;n++){const i=o[a[n]];if(e>=i.top&&e<=i.bottom&&t>=i.left&&t<=i.right)return i}return null}(e,o);if(a&&i(t,a.axis,o))return[a];const c=[];return n.each(o.scales,(function(e){i(t,e.axis,o)||c.push(e)})),c}function r(t,e,n){const o=t.max-t.min,a=o*(e-1),i=t.isHorizontal()?n.x:n.y,c=(t.getValueForPixel(i)-t.min)/o||0;return{min:a*c,max:a*(1-c)}}function l(t,{min:e,max:n},o,a=!1){const{axis:i,options:c}=t,{min:r=-1/0,max:l=1/0,minRange:s=0}=o&&o[i]||{},u=Math.max(e,r),m=Math.min(n,l),d=a?Math.max(m-u,s):t.max-t.min;if(m-u!==d)if(r>m-d)e=u,n=u+d;else if(l<u+d)n=m,e=m-d;else{const t=(d-m+u)/2;e=u-t,n=m+t}else e=u,n=m;return c.min=e,c.max=n,t.parse(e)!==t.min||t.parse(n)!==t.max}const s=t=>0===t||isNaN(t)?0:t<0?Math.min(Math.round(t),-1):Math.max(Math.round(t),1);const u={second:500,minute:3e4,hour:18e5,day:432e5,week:3024e5,month:1296e6,quarter:5184e6,year:157248e5};function m(t,e,n,o=!1){const{min:a,max:i,options:c}=t,r=c.time&&c.time.round,s=u[r]||0,m=t.getValueForPixel(t.getPixelForValue(a+s)-e),d=t.getValueForPixel(t.getPixelForValue(i+s)-e),{min:f=-1/0,max:h=1/0}=o&&n&&n[t.axis]||{};return m<f||d>h||l(t,{min:m,max:d},n,o)}function d(t,e,n){return m(t,e,n,!0)}const f={category:function(t,e,n,o){const a=r(t,e,n);return t.min===t.max&&e<1&&function(t){const e=t.getLabels().length-1;t.min>0&&(t.min-=1),t.max<e&&(t.max+=1)}(t),l(t,{min:t.min+s(a.min),max:t.max-s(a.max)},o,!0)},default:function(t,e,n,o){const a=r(t,e,n);return l(t,{min:t.min+a.min,max:t.max-a.max},o,!0)}},h={category:function(t,e,n){const o=t.getLabels().length-1;let{min:a,max:i}=t;const c=Math.max(i-a,1),r=Math.round(function(t){return t.isHorizontal()?t.width:t.height}(t)/Math.max(c,10)),s=Math.ceil(Math.abs(e/r));let u;return e<-r?(i=Math.min(i+s,o),a=1===c?i:i-c,u=i===o):e>r&&(a=Math.max(0,a-s),i=1===c?a:a+c,u=0===a),l(t,{min:a,max:i},n)||u},default:m,logarithmic:d,timeseries:d},p=new WeakMap;function x(t){let e=p.get(t);return e||(e={originalScaleLimits:{},handlers:{},panDelta:{}},p.set(t,e)),e}function g(t){const{originalScaleLimits:e}=x(t);return n.each(t.scales,(function(t){e[t.id]||(e[t.id]={min:t.options.min,max:t.options.max})})),n.each(e,(function(n,o){t.scales[o]||delete e[o]})),e}function y(t,e,o,a){const i=f[t.type]||f.default;n.callback(i,[t,e,o,a])}function b(t){const e=t.chartArea;return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}}function v(t,e,o="none"){const{x:a=1,y:r=1,focalPoint:l=b(t)}="number"==typeof e?{x:e,y:e}:e,{options:{limits:s,zoom:u}}=x(t),{mode:m="xy",overScaleMode:d}=u||{};g(t);const f=1!==a&&i(m,"x",t),h=1!==r&&i(m,"y",t),p=d&&c(d,l,t);n.each(p||t.scales,(function(t){t.isHorizontal()&&f?y(t,a,l,s):!t.isHorizontal()&&h&&y(t,r,l,s)})),t.update(o),n.callback(u.onZoom,[{chart:t}])}function M(t,e,n){const o=t.getValueForPixel(e),a=t.getValueForPixel(n);return{min:Math.min(o,a),max:Math.max(o,a)}}function z(t,e,o){const{panDelta:a}=x(t.chart);e+=a[t.id]||0;const i=h[t.type]||h.default;n.callback(i,[t,e,o])?a[t.id]=0:a[t.id]=e}function k(t,e,o,a="none"){const{x:c=0,y:r=0}="number"==typeof e?{x:e,y:e}:e,{options:{pan:l,limits:s}}=x(t),{mode:u="xy",onPan:m}=l||{};g(t);const d=0!==c&&i(u,"x",t),f=0!==r&&i(u,"y",t);n.each(o||t.scales,(function(t){t.isHorizontal()&&d?z(t,c,s):!t.isHorizontal()&&f&&z(t,r,s)})),t.update(a),n.callback(m,[{chart:t}])}function w(t,e,n){const{handlers:o}=x(t),a=o[n];a&&(e.removeEventListener(n,a),delete o[n])}function P(t,e,n,o){const{handlers:a,options:i}=x(t);w(t,e,n),a[n]=e=>o(t,e,i),e.addEventListener(n,a[n])}function C(t,e){const n=x(t);n.dragStart&&(n.dragging=!0,n.dragEnd=e,t.update("none"))}function S(t,e,o){const{onZoomStart:a,onZoomRejected:i}=o;if(a){const{left:o,top:c}=e.target.getBoundingClientRect(),r={x:e.clientX-o,y:e.clientY-c};if(!1===n.callback(a,[{chart:t,event:e,point:r}]))return n.callback(i,[{chart:t,event:e}]),!1}}function j(t,e){const o=x(t),{pan:a,zoom:i}=o.options,c=a&&a.modifierKey;if(c&&e[c+"Key"])return n.callback(i.onZoomRejected,[{chart:t,event:e}]);!1!==S(t,e,i)&&(o.dragStart=e,P(t,t.canvas,"mousemove",C))}function R(t,e,n,o){const{left:a,top:c}=n.target.getBoundingClientRect(),r=i(e,"x",t),l=i(e,"y",t);let{top:s,left:u,right:m,bottom:d,width:f,height:h}=t.chartArea;r&&(u=Math.min(n.clientX,o.clientX)-a,m=Math.max(n.clientX,o.clientX)-a),l&&(s=Math.min(n.clientY,o.clientY)-c,d=Math.max(n.clientY,o.clientY)-c);const p=m-u,x=d-s;return{left:u,top:s,right:m,bottom:d,width:p,height:x,zoomX:r&&p?1+(f-p)/f:1,zoomY:l&&x?1+(h-x)/h:1}}function Y(t,e){const o=x(t);if(!o.dragStart)return;w(t.canvas,"mousemove",t);const a=o.options.zoom,c=R(t,a.mode,o.dragStart,e),{width:r,height:s}=c;o.dragStart=o.dragEnd=null;const u=a.threshold||0;r<=u&&s<=u||(!function(t,e,o,a="none"){const{options:{limits:c,zoom:r}}=x(t),{mode:s="xy"}=r;g(t);const u=i(s,"x",t),m=i(s,"y",t);n.each(t.scales,(function(t){t.isHorizontal()&&u?l(t,M(t,e.x,o.x),c,!0):!t.isHorizontal()&&m&&l(t,M(t,e.y,o.y),c,!0)})),t.update(a),n.callback(r.onZoom,[{chart:t}])}(t,{x:c.left,y:c.top},{x:c.right,y:c.bottom},"zoom"),setTimeout((()=>o.dragging=!1),500),n.callback(a.onZoomComplete,[t]))}function Z(t,e){const{handlers:{onZoomComplete:o},options:{zoom:a}}=x(t);if(!function(t,e,o){const{wheelModifierKey:a,onZoomRejected:i}=o;if(!a||e[a+"Key"]){if(!1!==S(t,e,o)&&(e.cancelable&&e.preventDefault(),void 0!==e.deltaY))return!0}else n.callback(i,[{chart:t,event:e}])}(t,e,a))return;const i=e.target.getBoundingClientRect(),c=1+(e.deltaY>=0?-a.speed:a.speed);v(t,{x:c,y:c,focalPoint:{x:e.clientX-i.left,y:e.clientY-i.top}}),o&&o()}function X(t,e,o,a){o&&(x(t).handlers[e]=function(t,e){let n;return function(){return clearTimeout(n),n=setTimeout(t,e),e}}((()=>n.callback(o,[{chart:t}])),a))}function E(t){const e=x(t);return function(o,a){const i=e.options.pan;if(!i||!i.enabled)return!1;if(!a||!a.srcEvent)return!0;const c=i.modifierKey;return!(c&&"mouse"===a.pointerType&&!a.srcEvent[c+"Key"])||(n.callback(i.onPanRejected,[{chart:t,event:a}]),!1)}}function T(t,e,n){if(e.scale){const{center:o,pointers:a}=n,c=1/e.scale*n.scale,r=n.target.getBoundingClientRect(),l=function(t,e){const n=Math.abs(t.clientX-e.clientX),o=Math.abs(t.clientY-e.clientY),a=n/o;let i,c;return a>.3&&a<1.7?i=c=!0:n>o?i=!0:c=!0,{x:i,y:c}}(a[0],a[1]),s=e.options.zoom.mode;v(t,{x:l.x&&i(s,"x",t)?c:1,y:l.y&&i(s,"y",t)?c:1,focalPoint:{x:o.x-r.left,y:o.y-r.top}}),e.scale=n.scale}}function F(t,e,n){const o=e.delta;o&&(e.panning=!0,k(t,{x:n.deltaX-o.x,y:n.deltaY-o.y},e.panScales),e.delta={x:n.deltaX,y:n.deltaY})}const H=new WeakMap;function D(t,e){const o=x(t),i=t.canvas,{pan:r,zoom:l}=e,s=new a.default.Manager(i);l&&l.enabled&&(s.add(new a.default.Pinch),s.on("pinchstart",(()=>function(t,e){e.options.zoom.enabled&&(e.scale=1)}(0,o))),s.on("pinch",(e=>T(t,o,e))),s.on("pinchend",(e=>function(t,e,o){e.scale&&(T(t,e,o),e.scale=null,n.callback(e.options.zoom.onZoomComplete,[{chart:t}]))}(t,o,e)))),r&&r.enabled&&(s.add(new a.default.Pan({threshold:r.threshold,enable:E(t)})),s.on("panstart",(e=>function(t,e,o){const{enabled:a,overScaleMode:i,onPanStart:r,onPanRejected:l}=e.options.pan;if(!a)return;const s=o.target.getBoundingClientRect(),u={x:o.center.x-s.left,y:o.center.y-s.top};if(!1===n.callback(r,[{chart:t,event:o,point:u}]))return n.callback(l,[{chart:t,event:o}]);e.panScales=i&&c(i,u,t),e.delta={x:0,y:0},clearTimeout(e.panEndTimeout),F(t,e,o)}(t,o,e))),s.on("panmove",(e=>F(t,o,e))),s.on("panend",(()=>function(t,e){e.delta=null,e.panning&&(e.panEndTimeout=setTimeout((()=>e.panning=!1),500),n.callback(e.options.pan.onPanComplete,[{chart:t}]))}(t,o)))),H.set(t,s)}var K={id:"zoom",version:"1.0.0-beta.5",defaults:{pan:{enabled:!1,mode:"xy",threshold:10,modifierKey:null},zoom:{enabled:!1,mode:"xy",speed:.1,wheelModifierKey:null}},start:function(t,e,o){x(t).options=o,a.default&&D(t,o),t.pan=(e,n,o)=>k(t,e,n,o),t.zoom=(e,n)=>v(t,e,n),t.zoomScale=(e,n,o)=>function(t,e,n,o="none"){g(t),l(t.scales[e],n,void 0,!0),t.update(o)}(t,e,n,o),t.resetZoom=e=>function(t,e="default"){const o=g(t);n.each(t.scales,(function(t){const e=t.options;o[t.id]?(e.min=o[t.id].min,e.max=o[t.id].max):(delete e.min,delete e.max)})),t.update(e)}(t,e)},beforeEvent(t,e){const n=x(t),o=e.event.type;if(("click"===o||"mouseup"===o)&&(n.panning||n.dragging))return!1},beforeUpdate:function(t,e,n){x(t).options=n,function(t,e){const n=t.canvas,{enabled:o,drag:a,onZoomComplete:i}=e.zoom;o&&!a?(P(t,n,"wheel",Z),X(t,"onZoomComplete",i,250)):w(t,n,"wheel"),o&&a?(P(t,n,"mousedown",j),P(t,n.ownerDocument,"mouseup",Y)):(w(t,n,"mousedown"),w(t,n,"mousemove"),w(t,n.ownerDocument,"mouseup"))}(t,n)},beforeDatasetsDraw:function(t,e,n){const{dragStart:o,dragEnd:a}=x(t);if(a){const{left:e,top:i,width:c,height:r}=R(t,n.zoom.mode,o,a),l=n.zoom.drag,s=t.ctx;s.save(),s.beginPath(),s.fillStyle=l.backgroundColor||"rgba(225,225,225,0.3)",s.fillRect(e,i,c,r),l.borderWidth>0&&(s.lineWidth=l.borderWidth,s.strokeStyle=l.borderColor||"rgba(225,225,225)",s.strokeRect(e,i,c,r)),s.restore()}},stop:function(t){!function(t){const{canvas:e}=t;e&&(w(t,e,"mousedown"),w(t,e,"mousemove"),w(t,e.ownerDocument,"mouseup"),w(t,e,"wheel"),w(t,e,"click"))}(t),a.default&&function(t){const e=H.get(t);e&&(e.remove("pinchstart"),e.remove("pinch"),e.remove("pinchend"),e.remove("panstart"),e.remove("pan"),e.remove("panend"),e.destroy(),H.delete(t))}(t),function(t){p.delete(t)}(t)},panFunctions:h,zoomFunctions:f};return t.Chart.register(K),K}));
